<%- include('partials/header') -%>
<div class="container">
  <div class="row justify-content-center mt-5">
    <div class="col-6">
      <h2><%=listing.title%></h2>
      <div>Posted by: <a href="/publicProfile/<%=listing.user%>"><%=employer.name%></a></div>
        <% if (listing.image) { %>
          <img class="img-fluid" src="<%= listing.image%>">
        <% } else { %>
          <img class="img-fluid" src="/imgs/default-post-pic.jpg" alt="default post pic">
        <% } %>
      <%if(listing.user == user.id){ %>
      <div class="row justify-content-between">
        <form
          action="/listing/deleteListing/<%=listing.id%>?_method=DELETE"
          method="POST"
          class="col-3"
        >
          <button class="btn btn-secondary fa fa-trash" type="submit"></button>
        </form>
      </div>
      <% } %>
    </div>
    <div class="col-3 mt-5">
      <h4><%=listing.location%></h4>
      <h3><%=listing.company%></h3>
      <h3><%=listing.number%></h3>
      <h3><%=listing.address%></h3>
      <h5><%=listing.site%></h5>
      <h2><%=listing.description%></h2>
    </div>
    <div class="mt-5">
      <%if(listing.user != user.id){ %>
      <h2>Ask a question</h2>
      <form action="/questions/createQuestion/<%=listing.id%>" method="POST">
        <div class="mb-3">
          <label for="question" class="form-label">Question</label>
          <input
            type="text"
            class="form-control"
            id="question"
            name="question"
          />
        </div>
        <button type="submit" class="btn btn-secondary">Ask</button>
      </form>
      <%}%>
    </div>
    <ul>
      <% for(let i=0; i<questions.length; i++) {%>
        <li class="col-6 justify-content-between mt-5">
          <%=questions[i].question%>
          <div>Asked by: <a href="/publicProfile/<%=questions[i].user%>"><%=seeker.name%></a></div>
          <%if (questions[i].answer != undefined){ %>
            <ul>
              <li><%=questions[i].answer%></li>
            </ul>
          <%} else {%>
            <div class="mt-5">
              <%if(listing.user == user.id){ %>
                <h2>Answer the question</h2>
                <form action="/questions/addAnswer/<%=questions[i]._id%>/<%=listing.id%>?_method=PUT" method="POST">
                  <div class="mb-3">
                    <label for="answer" class="form-label">Answer</label>
                    <input type="text" class="form-control" id="answer" name="answer">
                  </div>
                  <button type="submit" class="btn btn-secondary">Answer</button>
                </form>
              <%}%>
            </div>
          <%}%>
        </li>
      <% } %>
    </ul>
    <div class="col-6 mt-5">
      <a class="btn btn-secondary" href="/profile">Return to Profile</a>
      <a class="btn btn-secondary" href="/feed">Return to Feed</a>
    </div>
  </div>
</div>

<%- include('partials/footer') -%>